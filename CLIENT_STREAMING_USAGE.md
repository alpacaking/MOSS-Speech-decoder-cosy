# Streaming Codec éæµå¼è§£ç  API å®¢æˆ·ç«¯ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`client_streaming.sh` æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºè°ƒç”¨ Streaming Codec çš„ Gradio API è¿›è¡Œéæµå¼éŸ³é¢‘è½¬æ¢ã€‚

## ç‰¹æ€§

- âœ… **å‘½ä»¤è¡Œå‚æ•°åŒ–**ï¼šé€šè¿‡å‚æ•°æŒ‡å®š API URLã€è¾“å…¥éŸ³é¢‘ã€å‚è€ƒéŸ³é¢‘å’Œè¾“å‡ºè·¯å¾„
- âœ… **å®æ—¶è½®è¯¢**ï¼šè‡ªåŠ¨è½®è¯¢ SSE æµç›´åˆ°å¤„ç†å®Œæˆï¼Œæ— éœ€å†™æ­»ç­‰å¾…æ—¶é—´
- âœ… **çº¯ Bash å®ç°**ï¼šä»…ä½¿ç”¨ `curl`ã€`jq`ã€`base64` ç­‰æ ‡å‡†å·¥å…·ï¼Œæ— åµŒå…¥ Python è„šæœ¬
- âœ… **å†…å­˜å¤„ç†**ï¼šé¿å…ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼Œæ‰€æœ‰æ•°æ®åœ¨å†…å­˜ä¸­å¤„ç†
- âœ… **å®æ—¶è¿›åº¦**ï¼šæ˜¾ç¤ºå¤„ç†è¿›åº¦å’Œè€—æ—¶ç»Ÿè®¡

## ä¾èµ–

ç¡®ä¿ç³»ç»Ÿä¸­å·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š
- `curl` - HTTP å®¢æˆ·ç«¯
- `jq` - JSON è§£æå™¨
- `base64` - Base64 ç¼–è§£ç å·¥å…·

## ç”¨æ³•

```bash
./client_streaming.sh <API_URL> <INPUT_AUDIO> <REF_AUDIO> <OUTPUT_FILE>
```

### å‚æ•°è¯´æ˜

1. **API_URL**: Gradio æœåŠ¡çš„ URLï¼ˆä¾‹å¦‚ï¼š`http://127.0.0.1:7864`ï¼‰
2. **INPUT_AUDIO**: è¾“å…¥éŸ³é¢‘æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆå¾…è½¬æ¢çš„éŸ³é¢‘ï¼‰
3. **REF_AUDIO**: å‚è€ƒéŸ³é¢‘æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆæä¾›ç›®æ ‡éŸ³è‰²ï¼‰
4. **OUTPUT_FILE**: è¾“å‡ºéŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„ï¼ˆç”Ÿæˆçš„ WAV æ–‡ä»¶ï¼‰

## ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•

```bash
/inspire/hdd/project/embodied-multimodality/public/lzjjin/Streaming-Codec/client_streaming.sh \
  "http://127.0.0.1:7864" \
  "/path/to/input.mp3" \
  "/path/to/reference.wav" \
  "output.wav"
```

### å®é™…ç¤ºä¾‹

```bash
/inspire/hdd/project/embodied-multimodality/public/lzjjin/Streaming-Codec/client_streaming.sh \
  "http://127.0.0.1:7864" \
  "/inspire/hdd/project/embodied-multimodality/public/datasets/haitianruisheng_3/segment_00_000/00460fd0bd40915bd31e79976176c9b5_001.mp3" \
  "/inspire/hdd/project/embodied-multimodality/public/datasets/LibriTTS/LibriTTS/train-clean-100/103/1241/103_1241_000027_000007.wav" \
  "converted_audio.wav"
```

## è¾“å‡ºç¤ºä¾‹

```
===================================================
ğŸš€ Streaming Codec API å®¢æˆ·ç«¯
===================================================
API URL: http://127.0.0.1:7864
è¾“å…¥éŸ³é¢‘: /path/to/input.mp3
å‚è€ƒéŸ³é¢‘: /path/to/reference.wav
è¾“å‡ºæ–‡ä»¶: output.wav
===================================================
[1/3] ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶...
   âœ… è¾“å…¥éŸ³é¢‘: /tmp/gradio/xxx/input.mp3
   âœ… å‚è€ƒéŸ³é¢‘: /tmp/gradio/xxx/reference.wav
[2/3] å‘èµ·å¤„ç†è¯·æ±‚...
   âœ… Event ID: abc123...
[3/3] ç­‰å¾…å¤„ç†å®Œæˆï¼ˆå®æ—¶è½®è¯¢ï¼‰...
   â³ å¤„ç†ä¸­... 3s
   âœ… æ£€æµ‹åˆ°å®Œæˆäº‹ä»¶ï¼Œæ­£åœ¨ä¿å­˜...
===================================================
ğŸ‰ å¤„ç†å®Œæˆï¼
   è¾“å‡ºæ–‡ä»¶: output.wav
   æ–‡ä»¶å¤§å°: 1.4M
   æ€»è€—æ—¶: 4s
===================================================
```

## å·¥ä½œåŸç†

1. **ä¸Šä¼ é˜¶æ®µ**ï¼šå°†è¾“å…¥éŸ³é¢‘å’Œå‚è€ƒéŸ³é¢‘ä¸Šä¼ åˆ° Gradio æœåŠ¡å™¨
2. **è¯·æ±‚é˜¶æ®µ**ï¼šå‘èµ·éæµå¼å¤„ç†è¯·æ±‚ï¼Œè·å– Event ID
3. **è½®è¯¢é˜¶æ®µ**ï¼šé€šè¿‡ SSEï¼ˆServer-Sent Eventsï¼‰å®æ—¶ç›‘å¬å¤„ç†è¿›åº¦
4. **æå–é˜¶æ®µ**ï¼šä» SSE å“åº”ä¸­æå– Base64 ç¼–ç çš„ WAV éŸ³é¢‘
5. **ä¿å­˜é˜¶æ®µ**ï¼šè§£ç  Base64 æ•°æ®å¹¶ä¿å­˜ä¸º WAV æ–‡ä»¶

## æŠ€æœ¯ç»†èŠ‚

- **API ç«¯ç‚¹**ï¼š
  - ä¸Šä¼ ï¼š`POST /gradio_api/upload`
  - è¯·æ±‚ï¼š`POST /gradio_api/call/process_audio_nonstreaming`
  - è½®è¯¢ï¼š`GET /gradio_api/call/process_audio_nonstreaming/{event_id}`

- **æ•°æ®æ ¼å¼**ï¼š
  - éŸ³é¢‘ç»„ä»¶éœ€è¦ FileData å…ƒæ•°æ®ï¼š`{"path": "...", "meta": {"_type": "gradio.FileData"}}`
  - SSE è¿”å› JSON æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºåŒ…å« Base64 éŸ³é¢‘çš„ HTML å­—ç¬¦ä¸²

- **Base64 æå–**ï¼š
  - ä½¿ç”¨ Bash æ­£åˆ™è¡¨è¾¾å¼ä» HTML ä¸­æå–ï¼š`data:audio/wav;base64,{base64_data}`
  - ç›´æ¥åœ¨å†…å­˜ä¸­å¤„ç†ï¼Œæ— ä¸´æ—¶æ–‡ä»¶

## æ€§èƒ½

- **å…¸å‹å¤„ç†æ—¶é—´**ï¼š4-10 ç§’ï¼ˆå–å†³äºè¾“å…¥éŸ³é¢‘é•¿åº¦ï¼‰
- **è¾“å‡ºæ–‡ä»¶å¤§å°**ï¼šçº¦ 1.4MBï¼ˆ24kHz 16-bit mono WAVï¼‰
- **å†…å­˜å ç”¨**ï¼šæå°ï¼ˆæµå¼å¤„ç†ï¼Œæ— ä¸´æ—¶æ–‡ä»¶ï¼‰

## é”™è¯¯å¤„ç†

è„šæœ¬ä¼šæ£€æŸ¥ä»¥ä¸‹é”™è¯¯ï¼š
- è¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨
- ç¼ºå°‘ä¾èµ–å·¥å…·
- API æœåŠ¡ä¸å¯ç”¨
- ä¸Šä¼ å¤±è´¥
- å¤„ç†å¤±è´¥
- Base64 è§£ç å¤±è´¥

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿ Gradio æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆé»˜è®¤ç«¯å£ 7864ï¼‰
2. è¾“å…¥éŸ³é¢‘æ–‡ä»¶å¿…é¡»å­˜åœ¨ä¸”å¯è¯»
3. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ä¿å­˜è¾“å‡ºæ–‡ä»¶
4. è„šæœ¬ä¼šè‡ªåŠ¨ç»ˆæ­¢ curl è¿›ç¨‹ä»¥å…³é—­ SSE è¿æ¥

## è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ç›¸åŒ

## æ›´æ–°æ—¥å¿—

- 2025-12-19: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒå‘½ä»¤è¡Œå‚æ•°ã€å®æ—¶è½®è¯¢ã€çº¯ Bash å®ç°
